<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="mb-0">
              <i class="fas fa-boxes me-2"></i>Gestión de Productos
            </h2>
            <a routerLink="/dashboard/products/create" class="btn btn-primary">
              <i class="fas fa-plus me-1"></i>Crear Producto
            </a>
          </div>
        </div>

        <div class="card-body">
          <!-- Filtros y Búsqueda -->
          <div class="row mb-4">
            <div class="col-md-4">
              <div class="form-group">
                <label for="searchInput" class="form-label">
                  <i class="fas fa-search me-1"></i>Buscar Productos
                </label>
                <input id="searchInput" type="text" class="form-control"
                  placeholder="Buscar por nombre, SKU o descripción..." [(ngModel)]="searchTerm"
                  (input)="onSearchChange()" />
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-group">
                <label for="categoryFilter" class="form-label">
                  <i class="fas fa-filter me-1"></i>Categoría
                </label>
                <select id="categoryFilter" class="form-select" [(ngModel)]="selectedCategory"
                  (change)="onFilterChange()">
                  <option value="">Todas las categorías</option>
                  <option *ngFor="let category of categories" [value]="category">
                    {{ category }}
                  </option>
                </select>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-group">
                <label for="statusFilter" class="form-label">
                  <i class="fas fa-toggle-on me-1"></i>Estado
                </label>
                <select id="statusFilter" class="form-select" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
                  <option value="">Todos los estados</option>
                  <option value="true">Activo</option>
                  <option value="false">Inactivo</option>
                </select>
              </div>
            </div>

            <div class="col-md-2">
              <div class="form-group">
                <label for="sortBy" class="form-label">
                  <i class="fas fa-sort me-1"></i>Ordenar
                </label>
                <select id="sortBy" class="form-select" [(ngModel)]="sortBy" (change)="onSortChange()">
                  <option value="name">Nombre</option>
                  <option value="price">Precio</option>
                  <option value="stock">Stock</option>
                  <option value="createdAt">Fecha</option>
                </select>
              </div>
            </div>
          </div>



          <!-- Vista de Tabla -->
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>
                    <i class="fas fa-image me-1"></i>Imagen
                  </th>
                  <th>
                    <i class="fas fa-tag me-1"></i>Nombre
                  </th>
                  <th>
                    <i class="fas fa-barcode me-1"></i>SKU
                  </th>
                  <th>
                    <i class="fas fa-folder me-1"></i>Categoría
                  </th>
                  <th>
                    <i class="fas fa-dollar-sign me-1"></i>Precio
                  </th>
                  <th>
                    <i class="fas fa-boxes me-1"></i>Stock
                  </th>
                  <th>
                    <i class="fas fa-toggle-on me-1"></i>Estado
                  </th>
                  <th>
                    <i class="fas fa-cog me-1"></i>Acciones
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let product of filteredProducts">
                  <td>
                    <img [src]="product.imageUrl || 'assets/img/no-image.png'" class="product-thumbnail"
                      [alt]="product.name" (error)="onImageError($event)" />
                  </td>
                  <td>
                    <div class="product-info">
                      <strong>{{ product.name }}</strong>
                      <small class="text-muted d-block">{{ product.description | slice:0:50 }}...</small>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-secondary">{{ product.sku }}</span>
                  </td>
                  <td>
                    <span class="badge bg-info">{{ product.category }}</span>
                  </td>
                  <td>
                    <div class="price-info">
                      <span class="original-price" *ngIf="product.discountPrice">
                        {{ product.price | currency }}
                      </span>
                      <span class="current-price" [class.discount]="product.discountPrice">
                        {{ (product.discountPrice || product.price) | currency }}
                      </span>
                      <span class="discount-badge" *ngIf="product.discountPercentage">
                        -{{ product.discountPercentage }}%
                      </span>
                    </div>
                  </td>
                  <td>
                    <div class="stock-info">
                      <span [class]="getStockClass(product.stock, product.minStock)">
                        {{ product.stock }}
                      </span>
                      <small class="text-muted d-block">Mín: {{ product.minStock }}</small>
                    </div>
                  </td>
                  <td>
                    <span [class]="product.isActive ? 'badge bg-success' : 'badge bg-danger'">
                      {{ product.isActive ? 'Activo' : 'Inactivo' }}
                    </span>
                  </td>
                  <td>
                    <div class="btn-group" role="group">
                      <a [routerLink]="['/dashboard/products/edit', product.id]" class="btn btn-warning btn-sm"
                        title="Editar">
                        <i class="fas fa-edit"></i>
                      </a>
                      <button class="btn btn-info btn-sm" (click)="viewProduct(product)" title="Ver detalles">
                        <i class="fas fa-eye"></i>
                      </button>
                      <button class="btn btn-danger btn-sm" (click)="deleteProduct(product.id)" title="Eliminar">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Paginación -->
          <div class="row" *ngIf="filteredProducts.length > 0">
            <div class="col-12">
              <nav aria-label="Navegación de productos">
                <ul class="pagination justify-content-center">
                  <li class="page-item" [class.disabled]="currentPage === 1">
                    <button class="page-link" (click)="previousPage()">
                      <i class="fas fa-chevron-left"></i>
                    </button>
                  </li>
                  <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
                    <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
                  </li>
                  <li class="page-item" [class.disabled]="currentPage === totalPages">
                    <button class="page-link" (click)="nextPage()">
                      <i class="fas fa-chevron-right"></i>
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          </div>

          <!-- Mensaje cuando no hay productos -->
          <div class="row" *ngIf="filteredProducts.length === 0">
            <div class="col-12 text-center py-5">
              <i class="fas fa-box-open fa-3x text-muted mb-3"></i>
              <h4 class="text-muted">No se encontraron productos</h4>
              <p class="text-muted">Intenta ajustar los filtros o crear un nuevo producto.</p>
              <a routerLink="/dashboard/products/create" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Crear Producto
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>